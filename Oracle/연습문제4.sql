--■■■ 실습 4-
CREATE TABLE MEMBER (
    MEMBER_ID       NUMBER(4) PRIMARY KEY
    , NAME          VARCHAR2(40)    NOT NULL
    , ADDRESS       VARCHAR2(100)   
    , HP            CHAR(13)        
    , JOIN_DATE     TIMESTAMP       NOT NULL
);
    
CREATE TABLE BOOK (
    BOOK_ID         NUMBER(5)       PRIMARY KEY
    ,TITLE          VARCHAR2(50)    NOT NULL
    ,AUTHOR         VARCHAR2(40)    NOT NULL
    ,publisher      VARCHAR2(40)    NOT NULL
    ,available      CHAR(1)
    ,reg_date       TIMESTAMP       NOT NULL
);

CREATE TABLE LOAN (
    loan_Id         NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
    ,member_Id      NUMBER(4)   NOT NULL
    ,book_Id        NUMBER(5)   NOT NULL
    ,loan_date      TIMESTAMP
    ,return_date    TIMESTAMP
    ,actual_date    TIMESTAMP
);


--■■■ 실습 4-3
INSERT INTO MEMBER (MEMBER_ID, NAME, ADDRESS, HP, JOIN_DATE) VALUES (1001, '김유신', '서울특별시 강남구 역삼동', '010-1234-1001', '2024-01-10 09:15:00');
INSERT INTO MEMBER (MEMBER_ID, NAME, ADDRESS, HP, JOIN_DATE) VALUES (1002, '김춘추', '대전광역시 유성구 장대동', '010-1234-1002', '2024-02-14 14:30:45');
INSERT INTO MEMBER (MEMBER_ID, NAME, ADDRESS, HP, JOIN_DATE) VALUES (1003, '장보고', '대구광역시 수성구 범어동', '010-1234-1003', '2024-03-01 11:05:20');
INSERT INTO MEMBER (MEMBER_ID, NAME, ADDRESS, HP, JOIN_DATE) VALUES (1004, '강감찬', '부산광역시 금정구 부곡동', '010-1234-1004', '2024-03-22 16:40:00');
INSERT INTO MEMBER (MEMBER_ID, NAME, ADDRESS, HP, JOIN_DATE) VALUES (1005, '이순신', '광주광역시 광산구 우산동', '010-1234-1005', '2024-04-10 08:50:10');

INSERT INTO BOOK(BOOK_ID, TITLE, AUTHOR, PUBLISHER, AVAILABLE, REG_DATE) VALUES (10001, '태백산맥', '조정래', '문학수첩', 'Y', '2014-01-10 09:15:00');
INSERT INTO BOOK(BOOK_ID, TITLE, AUTHOR, PUBLISHER, AVAILABLE, REG_DATE) VALUES (10002, '데미안', '헤르만 헤세', '민음사', 'N', '2014-02-14 14:30:45');
INSERT INTO BOOK(BOOK_ID, TITLE, AUTHOR, PUBLISHER, AVAILABLE, REG_DATE) VALUES (10003, '토지', '박경리', '문학사상', 'Y', '2014-03-01 11:05:20');
INSERT INTO BOOK(BOOK_ID, TITLE, AUTHOR, PUBLISHER, AVAILABLE, REG_DATE) VALUES (10004, '명품 자바 프로그래밍', '제임스 고슬링', '한빛출판사', 'Y', '2014-03-22 16:40:00');
INSERT INTO BOOK(BOOK_ID, TITLE, AUTHOR, PUBLISHER, AVAILABLE, REG_DATE) VALUES (10005, '로미오와 줄리엣', '셰익스피어', '열린책들', 'N', '2014-04-10 08:50:10');
INSERT INTO BOOK(BOOK_ID, TITLE, AUTHOR, PUBLISHER, AVAILABLE, REG_DATE) VALUES (10006, '삼국지', '나관중', '민음사', 'Y', '2014-04-05 09:12:02');
INSERT INTO BOOK(BOOK_ID, TITLE, AUTHOR, PUBLISHER, AVAILABLE, REG_DATE) VALUES (10007, '칼의 노래', '김훈', '문학동네', 'Y', '2014-06-10 12:53:17');
INSERT INTO BOOK(BOOK_ID, TITLE, AUTHOR, PUBLISHER, AVAILABLE, REG_DATE) VALUES (10008, '데이터베이스', '래리 엘리슨', '한빛출판사', 'N', '2014-05-23 10:13:09');
INSERT INTO BOOK(BOOK_ID, TITLE, AUTHOR, PUBLISHER, AVAILABLE, REG_DATE) VALUES (10009, 'Linux 운영체제', '리누스 토발즈', '한빛출판사', 'Y', '2014-03-11 11:23:43');
INSERT INTO BOOK(BOOK_ID, TITLE, AUTHOR, PUBLISHER, AVAILABLE, REG_DATE) VALUES (10010, '어린 왕자', '생텍쥐페리', '열린책들', 'Y', '2014-05-13 15:27:21');


INSERT INTO LOAN (LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE, RETURN_DATE, ACTUAL_DATE) VALUES(1, 1001, 10002, '2024-03-01 10:02:31', '2024-03-15 10:02:31', '2024-03-13 09:44:19');
INSERT INTO LOAN (LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE, RETURN_DATE, ACTUAL_DATE) VALUES (2, 1002, 10004, '2024-03-05 15:10:02', '2024-03-19 15:10:02', '2024-03-12 17:12:30');
INSERT INTO LOAN (LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE, RETURN_DATE, ACTUAL_DATE) VALUES (3, 1003, 10008, '2024-04-01 11:01:12', '2024-04-15 11:01:12', NULL);
INSERT INTO LOAN (LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE, RETURN_DATE, ACTUAL_DATE) VALUES (4, 1002, 10001, '2024-04-10 14:32:01', '2024-04-24 14:32:01', '2024-04-22 13:56:32');
INSERT INTO LOAN (LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE, RETURN_DATE, ACTUAL_DATE) VALUES (5, 1005, 10004, '2024-04-15 16:24:21', '2024-04-29 16:24:21', NULL);
INSERT INTO LOAN (LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE, RETURN_DATE, ACTUAL_DATE) VALUES (6, 1004, 10006, '2024-05-01 09:12:09', '2024-05-15 09:12:09', '2024-05-14 09:21:27');
INSERT INTO LOAN (LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE, RETURN_DATE, ACTUAL_DATE) VALUES (7, 1001, 10007, '2024-05-03 13:51:07', '2024-05-17 13:51:07', '2024-05-16 14:05:10');
INSERT INTO LOAN (LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE, RETURN_DATE, ACTUAL_DATE) VALUES (8, 1003, 10009, '2024-06-01 11:15:43', '2024-06-15 11:15:43', NULL);
INSERT INTO LOAN (LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE, RETURN_DATE, ACTUAL_DATE) VALUES (9, 1004, 10004, '2024-06-02 12:30:52', '2024-06-16 12:30:52', NULL);
INSERT INTO LOAN (LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE, RETURN_DATE, ACTUAL_DATE) VALUES (10, 1002, 10008, '2024-06-05 10:06:17', '2024-06-19 10:06:17', NULL);

--■■■ 실습 4-
SELECT * FROM MEMBER;
--■■■ 실습 4-5
SELECT * FROM BOOK;
--■■■ 실습 4-6
SELECT NAME, ADDRESS FROM MEMBER WHERE address LIKE '부산%';
--■■■ 실습 4-7
SELECT TITLE FROM BOOK WHERE available = 'Y';
--■■■ 실습 4-8
SELECT BOOK_ID, TITLE, AUTHOR, PUBLISHER, AVAILABLE, REG_DATE 
    FROM BOOK WHERE BOOK_ID = 10005;
--■■■ 실습 4-9
SELECT MEMBER_ID, NAME, HP FROM MEMBER WHERE member_id = 1002;
--■■■ 실습 4-10
SELECT TITLE
FROM BOOK
WHERE REG_DATE BETWEEN TO_DATE('2014-03-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS')
                 AND TO_DATE('2014-03-31 23:59:59', 'YYYY-MM-DD HH24:MI:SS');

--■■■ 실습 4-11
SELECT TITLE, AUTHOR, PUBLISHER FROM BOOK
    WHERE publisher = '민음사';
--■■■ 실습 4-12
SELECT LOAN_ID, MEMBER_ID, BOOK_ID FROM LOAN WHERE ACTUAL_DATE IS NULL;
--■■■ 실습 4-13
SELECT MEMBER_ID, NAME, ADDRESS, HP, JOIN_DATE FROM MEMBER WHERE NAME LIKE '김%';
--■■■ 실습 4-14
SELECT NAME, ADDRESS FROM MEMBER WHERE ADDRESS LIKE('부%') OR ADDRESS LIKE('대구%');
--■■■ 실습 4-15
SELECT BOOK_ID, TITLE FROM BOOK WHERE BOOK_ID IN (10003, 10006);
--■■■ 실습 4-16
SELECT TITLE, AUTHOR FROM BOOK WHERE AUTHOR IN ('조정래', '박경리');
--■■■ 실습 4-17
SELECT NAME, JOIN_DATE FROM MEMBER WHERE JOIN_DATE < TO_DATE('2024-04-01', 'YYYY-MM-DD');

--■■■ 실습 4-18
SELECT LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE FROM LOAN
    WHERE LOAN_DATE >= TO_DATE('2024-05-01' ,'YYYY-MM-DD');
--■■■ 실습 4-19
SELECT TITLE, AUTHOR, PUBLISHER FROM BOOK WHERE available = 'N';
--■■■ 실습 4-20
SELECT * FROM BOOK WHERE TITLE LIKE '%자바%';
--■■■ 실습 4-21
SELECT NAME, HP FROM MEMBER WHERE HP != '010-1234-1003';
--■■■ 실습 4-22
SELECT LOAN_ID, MEMBER_ID, BOOK_ID FROM LOAN
    WHERE actual_date <= TO_DATE('2024-03-20','YYYY-MM-DD');
--■■■ 실습 4-23
SELECT * FROM MEMBER ORDER BY NAME;
--■■■ 실습 4-24
SELECT TITLE, REG_DATE FROM BOOK ORDER BY REG_DATE DESC;
--■■■ 실습 4-25
SELECT TITLE FROM BOOK ORDER BY TITLE FETCH FIRST 3 ROW ONLY;
--■■■ 실습 4-26
SELECT * FROM MEMBER ORDER BY JOIN_DATE DESC FETCH FIRST 1 ROW ONLY;
--■■■ 실습 4-27
SELECT LOAN_ID, LOAN_DATE FROM LOAN ORDER BY LOAN_DATE FETCH FIRST 2 ROW ONLY;
--■■■ 실습 4-28
SELECT COUNT(*) FROM MEMBER;
--■■■ 실습 4-29
SELECT COUNT(*) FROM BOOK;
--■■■ 실습 4-30
SELECT COUNT(*) FROM BOOK WHERE available = 'Y';
--■■■ 실습 4-31
SELECT PUBLISHER, COUNT(*) "출판 도서수" FROM BOOK GROUP BY PUBLISHER;
--■■■ 실습 4-32
SELECT COUNT(*) FROM LOAN 
    WHERE LOAN_DATE 
    BETWEEN TO_DATE('2024-01-01', 'YYYY-MM-DD') AND TO_DATE('2024-12-31', 'YYYY-MM-DD');
--■■■ 실습 4-33
SELECT MEMBER_ID, COUNT(MEMBER_ID) FROM LOAN GROUP BY MEMBER_ID;
--■■■ 실습 4-34
SELECT BOOK_ID, COUNT(*) "대출횟수" FROM LOAN GROUP BY BOOK_ID;
--■■■ 실습 4-35
SELECT MEMBER_ID, COUNT(*)"대출횟수" FROM LOAN GROUP BY MEMBER_ID;
--■■■ 실습 4-36
SELECT BOOK_ID, COUNT(*) "대출횟수" FROM LOAN GROUP BY BOOK_ID HAVING COUNT(*) >= 2;
--■■■ 실습 4-37
SELECT L.MEMBER_ID, M.NAME, L.BOOK_ID, B.TITLE, L.LOAN_DATE
    FROM LOAN L
    JOIN MEMBER M ON L.MEMBER_ID = M.MEMBER_ID
    JOIN BOOK B ON B.BOOK_ID = L.BOOK_ID;
--■■■ 실습 4-38
SELECT NAME, COUNT(*) "대출건수" FROM LOAN L
    JOIN MEMBER M ON M.MEMBER_ID = l.member_id
    GROUP BY L.MEMBER_ID, NAME
    HAVING COUNT(*) >= 3;
--■■■ 실습 4-39
SELECT LOAN_ID, NAME, TITLE, LOAN_DATE FROM LOAN L
    JOIN MEMBER M   ON M.MEMBER_ID  = L.MEMBER_ID
    JOIN BOOK B     ON B.BOOK_ID    = L.BOOK_ID
    WHERE LOAN_DATE < TO_DATE('2024-05-01', 'YYYY-MM-DD');
--■■■ 실습 4-40
SELECT TITLE FROM LOAN L
    JOIN MEMBER M     ON M.MEMBER_ID  = L.MEMBER_ID
    JOIN BOOK   B     ON B.BOOK_ID    = L.BOOK_ID
    WHERE NAME = '김유신';
--■■■ 실습 4-41
SELECT NAME FROM LOAN L
    JOIN MEMBER M     ON M.MEMBER_ID  = L.MEMBER_ID
    JOIN BOOK   B     ON B.BOOK_ID    = L.BOOK_ID
    WHERE TITLE = '태백산맥';
--■■■ 실습 4-42
SELECT NAME, TITLE FROM LOAN L
    JOIN MEMBER M     ON M.MEMBER_ID  = L.MEMBER_ID
    JOIN BOOK   B     ON B.BOOK_ID    = L.BOOK_ID
    WHERE NAME = '김춘추'
    ORDER BY TITLE;
--■■■ 실습 4-43
SELECT NAME, TITLE FROM LOAN L
    JOIN MEMBER M     ON M.MEMBER_ID  = L.MEMBER_ID
    JOIN BOOK   B     ON B.BOOK_ID    = L.BOOK_ID
    WHERE LOAN_DATE BETWEEN TO_DATE('2024-04-01', 'YYYY-MM-DD')
                        AND TO_DATE('2024-04-30', 'YYYY-MM-DD')
    ;
--■■■ 실습 4-44
SELECT NAME, TITLE FROM LOAN L
    JOIN MEMBER M     ON M.MEMBER_ID  = L.MEMBER_ID
    JOIN BOOK   B     ON B.BOOK_ID    = L.BOOK_ID
    WHERE ACTUAL_DATE IS NULL
    ;

--■■■ 실습 4-45
SELECT NAME, TITLE FROM LOAN L
    JOIN MEMBER M     ON M.MEMBER_ID  = L.MEMBER_ID
    JOIN BOOK   B     ON B.BOOK_ID    = L.BOOK_ID
    WHERE AUTHOR = '조정래'
    ;

--■■■ 실습 4-46
SELECT
    B.BOOK_ID, B.TITLE
FROM
    BOOK B
LEFT JOIN
    LOAN L ON B.BOOK_ID = L.BOOK_ID
    WHERE L.BOOK_ID IS NULL;

--■■■ 실습 4-47
SELECT NAME, COUNT(*) "총 건수" FROM LOAN L
    JOIN MEMBER M     ON M.MEMBER_ID  = L.MEMBER_ID
    JOIN BOOK   B     ON B.BOOK_ID    = L.BOOK_ID
    GROUP BY NAME
    ORDER BY COUNT(*) DESC
    ;

--■■■ 실습 4-48
SELECT NAME 
    FROM (SELECT NAME, COUNT(*) "총 건수" FROM LOAN L
        JOIN MEMBER M     ON M.MEMBER_ID  = L.MEMBER_ID
        JOIN BOOK   B     ON B.BOOK_ID    = L.BOOK_ID
        GROUP BY NAME
        ORDER BY COUNT(*) DESC
        )
    FETCH FIRST 1 ROW ONLY;
--■■■ 실습 4-49
SELECT TITLE 
FROM BOOK B
WHERE PUBLISHER = (SELECT PUBLISHER FROM BOOK WHERE TITLE = '데이터베이스')
AND TITLE NOT IN('데이터베이스');

--■■■ 실습 4-50
SELECT
    M.NAME
FROM
    MEMBER M
WHERE
    M.MEMBER_ID IN (
        SELECT L.MEMBER_ID FROM LOAN L WHERE L.BOOK_ID = 10004);

--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-


--■■■ 실습 4-



